<!DOCTYPE HTML>
<html lang="utf-8">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="/ligerStatic/lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css">
    <link href="/ligerStatic/lib/ligerUI/skins/Gray/css/all.css" rel="stylesheet" type="text/css">
    <link href="/ligerStatic/css/style-item.css" rel="stylesheet" media="all"/>
    <script src="/ligerStatic/lib/jquery/jquery-1.5.2.min.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/ligerui.min.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerForm.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerButton.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerRadio.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/ligerUI/js/plugins/ligerTip.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/jquery-validation/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/jquery-validation/jquery.metadata.js" type="text/javascript"></script>
    <script src="/ligerStatic/lib/jquery-validation/messages_cn.js" type="text/javascript"></script>

    <script type="text/javascript">
        //t通过栏目名查出栏目ID
        var grid;
        var menu;
        var dlgedit = null;
        $(function () {
            var s = decodeURIComponent(getPar("coName"));
            s = s.substring(1, s.length - 1);

            var coName = s;
            if (coName !== null && coName !== "") {
                //根据栏目名获取文章ID
                init(coName);
                initListener();
            } else {
                $.ligerDialog.warn("地址URL参数错误,coName缺失或者错误");
            }
        });

        //请求所有栏目名 请求成功和本栏目名对应 得到栏目ID  根据栏目ID获得文章列表
        function init(mcoName) {
            var coId = 0;
            $.ajax({
                url: "/admin/cols",
                type: 'get',
                dataType: "json",
                success: function (result) {
                    var cols = result.extend.cols;
                    $.each(cols, function (index, col) {

                        if (col.coName == mcoName) {
                            coId = col.coId;
                        }
                    });
                    if (coId !== 0) {
                        //通过栏目id查询文章
                        initGrid(coId);
                    } else {
                        $.ligerDialog.warn("地址URL参数错误,不存在栏目");
                    }
                }

            });
        }


        /**
         * 初始化列表
         *
         **/
        function initGrid(coId) {
            $("form-info").ligerForm();
            menu = $.ligerMenu({
                width: 120, items:
                    [{text: '查看', click: itemclick}, {text: '刷新', click: itemclick}, {
                        text: '编辑',
                        click: itemclick
                    }]

            });
            grid = $("#articleList").ligerGrid({
                width: '100%',
                height: '100%',
                rowHeight: 30,
                headerRowHeight: 30,
                checkbox: true,
                rownumbers: true,
                enabledSort: false,
                columns: [
                    {name: 'id', display: '文章ID', hide: true, width: 70},
                    {name: 'coId', display: '栏目ID', hide: true, width: 70},
                    {name: 'title', display: '文章标题', align: 'left', width: 300},
                    {name: 'subTitle', display: '副标题', align: 'left', width: 200},
                    {name: 'publicTime', display: '更新时间'},
                    {
                        name: 'status', display: '审核状态', type: 'int', width: 70,
                        render: function (rowData) {
                            switch (rowData.status) {
                                case 0:
                                    return "<span style='color:dodgerblue'>起草</span>";
                                case 1:
                                    return "<span style='color:orangered'>审核中</span>";
                                case 2:
                                    return "<span style='color:green'>已发布</span>";
                            }

                        }
                    },
                    {name: 'from', display: '来源'},
                    {
                        name: 'isHot', display: '是否HOT', width: 70,
                        render: function (rowData) {
                            if (rowData.isHot === 'T') {
                                return "<span style='color:red'>HOT</span>";
                            } else {
                                return '';
                            }
                        }

                    },
                    {
                        name: 'isNew', display: '是否NEW', width: 70,
                        render: function (rowData) {
                            if (rowData.isNew === 'T') {
                                return "<span style='color:orange'>NEW</span>";
                            } else {
                                return '';
                            }
                        }
                    },
                    {name: 'clickCount', display: '点击数', width: 70}

                ],
                url: '/admin/arts/' + coId,
                method: 'get',
                usePager: true,
                pageSize: 10,//分页页面大小
                pageSizeOptions: [10, 20, 30],//可指定每页页面大小
                onDblClickRow: function (rowdata, rowindex) {
                    //跳转到content页面
                    window.open("/content.html?id=" + rowdata.id);
                },
                onContextmenu: function (parm, e) {
                    actionCustomerID = parm.data.CustomerID;
                    menu.show({top: e.pageY, left: e.pageX});
                    return false;
                }
            });

        }


        /**
         * 注册按钮监听器
         **/
        function initListener() {
            //有tab被移除的时候 就是编口关闭的时候 刷新表格 虽然会刷新全部的tab 但没有办法了
            top.tab.bind('AfterRemoveTabItem', function (tabID) {
                grid.loadData();
            });

            $("#btnAdd").click(function () {
                var tabId = "Tab" + new Date().getTime();
                parent.f_addTab(tabId, "编辑文章", "/admin/kindEditor?coId=" + coId);
            });
            $("#btnRefresh").click(function () {
                grid.loadData();
            });
            $("#btnDel").click(function () {
                var rows = grid.getSelectedRows();
                if (rows === null || rows.length === 0) {
                    $.ligerDialog.warn("您没有选择数据");
                } else {
                    var ids = '';
                    var rowmsg = '';//保存信息
                    $.each(rows, function (index, row) {
                        var id = row.id;
                        ids = ids + id + "-";
                        rowmsg += '文章标题： ' + row.title + "  " + "文章副标题   " + row.subTitle + "  "
                            + "更新时间  " + row.publicTime + "  " + "来源  " + row.from + "  " + "点击数 "
                            + row.clickCount + "  " + "状态 " + row.status + "<br>";
                    });
                    ids = ids.substring(0, ids.length - 1);

                    //提示确认
                    var msg = "您将删除以下文章：<br>" + rowmsg;

                    if (dlgedit == null) {
                        dlgedit = $.ligerDialog.open({
                            buttons: [{
                                text: '确认', onclick: function (i, d) {
                                    delBatch();
                                }
                            },
                                {
                                    text: '取消', onclick: function (i, d) {
                                    d.hide();
                                }
                                }],
                            content: msg, width: 350
                        });
                    } else {
                        dlgedit.show();
                    }

                    //批量删除
                    function delBatch() {
                        $.ajax({
                            url: "/admin/art/" + ids,
                            type: "delete",
                            dataType: "json",
                            success: function (result) {
                                $.ligerDialog.success(result.msg);
                                //刷新列表
                                grid.loadData();
                            },
                            error: function (code, result) {
                                $.ligerDialog.warn("发生错误，返回代码: " + code + "信息:  " + result.msg);
                            }
                        });

                    }

                }
            });

            $("#btnPublic").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];

            });
            $("#btnCheck").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnBack").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnsethot").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnSetNew").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnFrom").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btntime").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnCopy").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });
            $("#btnmove").click(function () {
                if (!selectedRowCheck()) {
                    return;
                }
                var row = grid.getSelectedRows()[0];
            });

        }

        //需要更新的属性
        function simpleUpdateArt(data, atrId) {
            $.ajax({
                url: "/admin/art" + atrId,
                type: "put",
                data: data,
                dataType: "json",
                success: function (result) {
                    $.ligerDialog.success(result.msg);
                    //刷新列表
                    grid.loadData();
                },
                error: function (code, result) {
                    $.ligerDialog.warn("发生错误，返回代码: " + code + "信息:  " + result.msg);
                }

            });

        }

        function selectedRowCheck() {
            var rows = grid.getSelectedRows();
            if (rows === null || rows.length === 0) {
                $.ligerDialog.warn("您没有选择数据");
                returne
                false;
            } else if (rows.length > 1) {
                $.ligerDialog.warn("只能选择一行数据");
                returne
                false;
            } else {
                return true;
            }
        }

        /**
         * 表格鼠标右键菜单
         **/
        function itemclick(data) {

            switch (data.text) {
                case '查看':
                    viewArt();
                    return;
                case '刷新':
                    grid.loadData();
                    return;
                case '编辑':
                    updateArt();
                    return;
            }
        }

        function updateArt() {
            var artId;
            //获取选择的列
            var rows = grid.getSelectedRows();
            if (rows === null || rows.length === 0) {
                $.ligerDialog.warn("您没有选择数据");
            } else if (rows.length > 1) {
                $.ligerDialog.warn("只能选择一篇文章编辑");
            } else {
                //跳转
                artId = rows[0].id;
                var tabId = "Tab" + new Date().getTime();
                parent.f_addTab(tabId, "编辑文章", "/admin/kindEditor?artId=" + artId);
            }
        }

        function viewArt() {
            var artId;
            //获取选择的列
            var rows = grid.getSelectedRows();
            if (rows === null || rows.length === 0) {
                $.ligerDialog.warn("您没有选择数据");
            } else if (rows.length > 1) {
                $.ligerDialog.warn("只能选择一篇文章查看");
            } else {
                //跳转
                artId = rows[0].id;
                window.open("/content.html?id=" + artId);
            }
        }


        /**
         * 取出来地址栏get参数
         * @param par 传入的参数名 如果有就取出数职 没有就null;
         * @returns {*}
         **/
        function getPar(par) {
            var localUrl = document.location.href;
            var get = localUrl.indexOf(par + "=");
            if (get === -1) {
                return null;
            }
            return localUrl.slice(par.length + get + 1);
        }

        /**
         * 获取对象的所有属性和方法
         * @param obj
         **/
        function displayProp(obj) {
            var names = "";
            for (var name in obj) {
                names += name + ": " + obj[name] + ", ";
            }
            alert(names);
        }

    </script>

</head>
<body>
<style type="text/css">

    #Mail {
        margin: 0 auto;
    }

    .block {
        height: 20px;
    }

    .line {
        height: 40px;
    }

    .btn {
        background: #FF3030;
        line-height: 20px;
        width: 50px;
        border-radius: 50px;
        border: 1px solid;
        color: #fff;
        font-size: 8px;
    }

    .back {
        background: #fff;
        line-height: 30px;
        width: 50px;
        border-radius: 50px;
        border: 1px solid;
        color: #999;
        font-size: 8px;
    }

    #refresh {
        background: #71C671;
        line-height: 20px;
        width: 50px;
        border-radius: 50px;
        border: 1px solid;
        color: #fff;
        font-size: 8px;
    }

    #delete {
        background: #778899;
        line-height: 20px;
        width: 50px;
        border-radius: 50px;
        border: 1px solid;
        color: #fff;
        font-size: 8px;
    }

    #unread {
        background: #FFA54F;
        line-height: 20px;
        width: 70px;
        border-radius: 50px;
        border: 1px solid;
        color: #fff;
        font-size: 8px;
    }

    .labels {
        width: 50px;
        display: inline-block;
    }

    .operate {
        margin: 0 auto;
    }

    .select {
        position: absolute;
        left: 55px;
    }
</style>

<div class="item-main">
    <table>
        <tr>
            <td style="width:5px"></td>
            <td><input id="btnAdd" type="button" value="新增" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnUpdate" type="button" value="编辑" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnDel" type="button" value="删除" class="l-button"
                       style="width:100px;color:#778899;"></input></td>

            <td style="width:5px"></td>
            <td><span>双击或右键选择查看</span></td>

            <td style="width:5px"></td>
            <td><input id="btnRefresh" type="button" value="刷新" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnPublic" type="button" value="发布" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnExamine" type="button" value="送审" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnBack" type="button" value="退回" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnSetHot" type="button" value="标记HOT" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnSetNew" type="button" value="标记NEW" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnFrom" type="button" value="编辑来源" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnTime" type="button" value="修改时间" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnCopy" type="button" value="复制到" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

            <td style="width:5px"></td>
            <td><input id="btnMove" type="button" value="移动到" class="l-button"
                       style="width:100px;color:#57b255;"></input></td>

        </tr>
    </table>
    <div class="container" align="center" style="width: 100%">
        <div id="articleList" style="width: 100%"></div>
    </div>


</div>

</body>
</html>